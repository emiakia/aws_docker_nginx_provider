---
- name: Install Docker and run NGINX container with a custom index.html
  hosts: localhost
  become: yes
  tasks:
    # Install necessary packages
    - name: Install Docker
      yum:
        name: docker
        state: present

    - name: Start Docker service
      service:
        name: docker
        state: started
        enabled: true

<<<<<<< HEAD
<<<<<<< HEAD
=======
>>>>>>> 52635d9 (ALB on ASG with Nginx By Ansible)
    # Get the local IP address
    - name: Get the local IP address
      shell: "hostname -I | awk '{print $1}'"
      register: local_ip
<<<<<<< HEAD
=======
    # Pull NGINX Docker image
    - name: Pull NGINX Docker image
      command: docker pull nginx:latest
>>>>>>> 863328d (nginx with ansible)
=======
>>>>>>> 52635d9 (ALB on ASG with Nginx By Ansible)

    # Create custom index.html
    - name: Create index.html file
      copy:
        content: |
          <html>
            <head><title>Hello from Docker NGINX!</title></head>
<<<<<<< HEAD
<<<<<<< HEAD
            <body><h1>Hello World from NGINX on Docker!</h1> 
            <p>Local IP: {{ local_ip.stdout }}</p>
            </body>
=======
            <body><h1>Hello World</h1><br><h1>From private IP: $(hostname -f)</h1></body>
>>>>>>> 863328d (nginx with ansible)
=======
            <body><h1>Hello World from NGINX on Docker!</h1> 
            <p>Local IP: {{ local_ip.stdout }}</p>
            </body>
>>>>>>> 52635d9 (ALB on ASG with Nginx By Ansible)
          </html>
        dest: /home/ec2-user/index.html

    # Run NGINX container with custom index.html
    - name: Run NGINX container
      command: >
        docker run -d --name nginx-container -p 80:80
        -v /home/ec2-user/index.html:/usr/share/nginx/html/index.html:ro nginx:latest
<<<<<<< HEAD
<<<<<<< HEAD
=======
      args:
        creates: /usr/share/nginx/html/index.html

    # Ensure the NGINX container is running
    - name: Ensure NGINX container is running
      command: docker ps -q --filter "name=nginx-container"
      register: nginx_container_status

    - name: Fail if NGINX container is not running
      fail:
        msg: "NGINX container is not running"
      when: nginx_container_status.stdout == ""
>>>>>>> 863328d (nginx with ansible)
=======
>>>>>>> 52635d9 (ALB on ASG with Nginx By Ansible)
